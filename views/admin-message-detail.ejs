<%- include('partials/header', { title: 'Détail du Message' }) %>

<main class="bg-gray-50 min-h-screen py-12 md:py-20">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        
        <!-- Navigation Back -->
        <div class="mb-8">
            <a href="/admin/messages" class="inline-flex items-center gap-2 text-slate-600 hover:text-accent transition font-medium">
                <i class="ph-bold ph-arrow-left"></i> Retour à la boîte de réception
            </a>
        </div>

        <!-- Message Card -->
        <div class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
            
            <!-- Header section of the card -->
            <div class="bg-slate-50/50 border-b border-slate-100 p-6 md:p-8 flex flex-col md:flex-row md:items-start md:justify-between gap-4">
                <div class="flex-1">
                    <div class="flex items-center gap-3 mb-2">
                        <h1 class="text-2xl font-bold text-slate-800"><%= message.subject %></h1>
                        <% if (!message.read) { %>
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-accent text-white">
                                Nouveau
                            </span>
                        <% } %>
                    </div>
                    
                    <div class="flex items-center gap-3 text-slate-600">
                        <div class="w-10 h-10 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center font-bold text-lg">
                            <%= message.first_name.charAt(0) %><%= message.last_name.charAt(0) %>
                        </div>
                        <div>
                            <div class="font-medium text-slate-900"><%= message.first_name %> <%= message.last_name %></div>
                            <div class="text-sm text-slate-500"><a href="mailto:<%= message.email %>" class="hover:text-blue-600 hover:underline"><%= message.email %></a></div>
                        </div>
                    </div>
                </div>

                <div class="text-slate-500 text-sm md:text-right whitespace-nowrap">
                    <div class="flex items-center gap-2 md:justify-end">
                        <i class="ph-bold ph-calendar-blank"></i>
                        <%= new Date(message.created_at).toLocaleDateString('fr-FR', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }) %>
                    </div>
                    <div class="flex items-center gap-2 md:justify-end mt-1">
                        <i class="ph-bold ph-clock"></i>
                        <%= new Date(message.created_at).toLocaleTimeString('fr-FR', { hour: '2-digit', minute:'2-digit' }) %>
                    </div>
                </div>
            </div>

            <!-- Content section -->
            <div class="p-6 md:p-8">
                <div class="prose prose-slate max-w-none">
                    <p class="whitespace-pre-wrap text-slate-700 leading-relaxed"><%= message.message %></p>
                </div>
            </div>

            <!-- Actions Footer -->
            <div class="bg-slate-50 px-6 py-4 border-t border-slate-200 flex flex-wrap items-center justify-between gap-4">
                <div class="flex items-center gap-3">
                    <!-- Toggle Read Status -->
                    <form action="/admin/messages/toggle-read/<%= message.id %>" method="POST">
                        <button type="submit" class="flex items-center gap-2 px-4 py-2 rounded-lg border border-slate-300 bg-white text-slate-700 hover:bg-slate-50 hover:text-accent transition text-sm font-medium">
                            <i class="ph-bold <%= message.read ? 'ph-check-circle' : 'ph-circle' %>"></i>
                            <%= message.read ? 'Marquer comme non lu' : 'Marquer comme lu' %>
                        </button>
                    </form>
                </div>

                <div class="flex items-center gap-3">
                    <!-- Delete -->
                    <form action="/admin/messages/delete/<%= message.id %>" method="POST" onsubmit="return confirm('Voulez-vous vraiment supprimer ce message ? Cette action est irréversible.');">
                        <button type="submit" class="flex items-center gap-2 px-4 py-2 rounded-lg border border-red-200 bg-red-50 text-red-600 hover:bg-red-100 transition text-sm font-medium">
                            <i class="ph-bold ph-trash"></i> Supprimer
                        </button>
                    </form>

                    <!-- Reply -->
                    <a href="mailto:<%= message.email %>?subject=Re: <%= message.subject %>&body=Bonjour <%= message.first_name %>," 
                       class="flex items-center gap-2 px-6 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 shadow-sm hover:shadow transition text-sm font-medium">
                        <i class="ph-bold ph-envelope-simple-open"></i> Répondre
                    </a>
                </div>
            </div>

        </div>

    </div>
</main>

<%- include('partials/footer') %>
